(function(kutils,$,_){'use strict';kutils.cumSumInPlace=function(arr){_.reduce(arr,function(acc,n){acc.push((acc.length>0?acc[acc.length-1]:0)+n);return acc;},[]);};kutils.cum_sum2=function(arr){var sm=0.0;var cumsum=[];for(var a=0;a<arr.length;a++){sm+=arr[a];if(a===0){cumsum[a]=arr[0];}
else cumsum[a]=cumsum[a-1]+arr[a];}
var cumsum2=[];for(a=0;a<cumsum.length;a++){cumsum2[a]=100.0*cumsum[a]/sm;}
return cumsum2;};var getSortedIndex=function(arr){var index=[];for(var i=0;i<arr.length;i++){index.push(i);}
index=index.sort((function(arr){return function(a,b){return((arr[a]>arr[b])?-1:((arr[a]<arr[b])?1:0));};})(arr));return index;};kutils.sortMultipleArrays=function(sort,followers){var index=getSortedIndex(sort),followed=[];followers.unshift(sort);followers.forEach(function(arr){var _arr=[];for(var i=0;i<arr.length;i++)
_arr[i]=arr[index[i]];followed.push(_arr);});var result={sorted:followed[0]};followed.shift();result.followed=followed;return result;};kutils.sanitizeString=function(s){return s.replace(/ /g,'_').toLowerCase();};kutils.arrayRemoveDuplicates=function(a){};kutils.makeRandomStringQAD=function(){return Math.random().toString().slice(2);};kutils.titleizeString=function(s){var title=s.charAt(0).toUpperCase()+s.slice(1);return title.replace(/_/g,'-');};kutils.sort_by=function(field,reverse,primer){var key=primer?function(x){return primer(x[field]);}:function(x){return x[field];};reverse=[-1,1][+!!reverse];return function(a,b){return a=key(a),b=key(b),reverse*((a>b)-(b>a));};};kutils.guidGenerator=function(){var S4=function(){return(((1+Math.random())*0x10000)|0).toString(16).substring(1);};return(S4()+S4()+"-"+S4()+"-"+S4()+"-"+S4()+"-"+S4()+S4()+S4());};}(window.kutils=window.utils||{},$,_));(function(kcharts,$,_){'use strict';kcharts.makeAPIMethod=function(chart,that,method){return function(_){if(!arguments.length){return that.params[method];}
that.params[method]=_;return chart;};};kcharts.COLS={'blue':'#4575b4','yellow':'#ffffbf','red':'#a50026'};kcharts.defaultSVG=function(data){var chart=this;var margins=chart.margins(),w=chart.width()||parseInt(chart.container.style('width'),10),h=chart.height()||parseInt(chart.container.style('height'),10),aw=chart.w=w-margins.left-margins.right,ah=chart.h=h-margins.top-margins.bottom;chart.svg=chart.container.attr("width",w).attr("height",h).selectAll('g').data([true]);chart.gEnter=chart.svg.enter().append('g');chart.svg.attr("transform","translate("+margins.left+","+margins.top+")");chart.gEnter.append("defs").append("clipPath").attr("id","clip-"+chart.id()).append("rect").attr("width",aw).attr("height",ah);};kcharts.addMouseOverlay=function(chart,params){chart.mouseRect=chart.svg.append('svg:rect').attr('width',chart.w).attr('height',chart.h).style('fill','none').style('pointer-events','all').on("mouseout",chart.hideActiveMarkers).on("mousemove",chart.showActiveMarkers).on("click",function(){console.log('clicked!');});};kcharts.drawAxes=function(params){var chart=this;var padX=chart.padX||0,padY=chart.padY||0,LABEL_PARAMS={'WX':15,'WY':5,'FFX':3,'FFY':6};chart.gEnter.append("g").attr("class","x axis");chart.gEnter.append("g").attr("class","y axis");chart.svg.select('.x.axis').attr("transform","translate(0,"+(chart.h)+")").call(chart.xAxis).selectAll("text").style("text-anchor","end").attr("dx","-.8em").attr("dy",".15em").attr("transform",function(d){return"rotate(-65)";});chart.svg.select('.y.axis').attr("transform","translate("+0+", 0)").call(chart.yAxis);if(chart.displaylabels()){var tEnter,text,al,bbox,text,nx;chart.gEnter.append("g").attr("class",'x axis-label');chart.gEnter.append("g").attr("class",'yLeft y axis-label');al=chart.svg.select('.x.axis-label').attr("transform","translate("+chart.w/2+","+(chart.h+chart.margins().bottom-10)+")");tEnter=al.selectAll('text').data([true]).enter();tEnter.append('text').text(chart.xName()||chart.xKey()).style('text-anchor','middle');if(chart.activeAxes()){al.classed('active',true);tEnter.insert('rect','text').attr('rx',5).attr('ry',5).style('fill','cornflowerblue');text=al.select('text').text(chart.xName()||chart.xKey()).style('cursor','pointer').style('stroke','#eee').on('click',function(d,i){chart.onXAxisClick(d,'x-axis');});bbox=text.node().getBBox();al.select('rect').attr('width',bbox.width+LABEL_PARAMS.WX).attr('height',bbox.height+LABEL_PARAMS.WY).attr('y',-bbox.height/2-LABEL_PARAMS.WY/2-3).attr('x',-bbox.width/2-LABEL_PARAMS.WX/2);}
al=chart.svg.select('.y.axis-label').attr("transform","rotate(-90) translate("+(0-chart.h/2)+","+(5-chart.margins().left)+")");tEnter=al.selectAll('text').data([true]).enter();tEnter.append('text').style("text-anchor","middle").attr("dy","1em").text(chart.yName()||chart.yKey());if(chart.activeAxes()){al.classed('active',true);tEnter.insert('rect','text').attr('rx',5).attr('ry',5).style('fill','cornflowerblue');text=al.select('text').text(chart.yName()||chart.yKey()).style('cursor','pointer').style('stroke','#eee').on('click',function(d,i){chart.onYAxisClick(d,'x-axis');});bbox=text.node().getBBox();al.select('rect').attr('width',bbox.width+LABEL_PARAMS.WX).attr('height',bbox.height+LABEL_PARAMS.WY).attr('y',-LABEL_PARAMS.WY/2+1).attr('x',-bbox.width/2-LABEL_PARAMS.WX/2);;}}};kcharts.areaZoom=function(){var _this=this;function brushstart(){if(d3.event.sourceEvent.detail==2){_this.x.domain(_this.defaultDomain);_this.redraw();}}
function brushed(){_this.x.domain(_this.brush.empty()?_this.x.domain():_this.brush.extent());_this.redraw();}
_this.brush=d3.svg.brush().x(_this.x).on("brushstart",brushstart).on("brushend",brushed).on('brush',function(){console.log('moved mouse');});_this.svg.append("g").attr("class","x brush").call(_this.brush).selectAll("rect").attr("y",-6).attr("height",_this.h+7).on('mousemove',function(){if(_this.onMouseMove){_this.onMouseMove(d3.mouse(this));}}).on('mouseout',function(){if(_this.onMouseOut){_this.onMouseOut(d3.mouse(this));}});};kcharts.makeSelectionBox=function(container,opts,changeCallback){d3.select(container).append("select").on("change",changeCallback).selectAll("option").data(opts).enter().append("option").attr("value",function(d){return d.value;}).text(function(d){return d.text;});};kcharts.makeMenuBox=function(container,opts,changeCallback){var bbox,pos=d3.mouse(container),menu=d3.select(container).append("ul").attr('class','dropdown-menu').attr('role','menu').attr('aria-labelledby',"dLabel").style('display','block');menu.selectAll("option").data(opts).enter().append("li").append("a").text(function(d){return d.text;}).on('click',function(c){changeCallback(c,menu);}).attr('cursor','pointer');bbox=menu[0][0].getBoundingClientRect();menu.style('top',(pos[1]-bbox.height)+'px').style('left',pos[0]+'px');return menu;};}(window.kcharts=window.kcharts||{},$,_));ï»¿
(function(kcharts,$,_){'use strict';kcharts.MultiLineChart=function(){var that=this,params=this.params={};this.params.id=kutils.makeRandomStringQAD();this.params.title="";this.params.yName='';this.params.y2Name='';this.params.xName='Date';this.params.height=null;this.params.width=null;this.params.margins={top:50,right:70,bottom:50,left:100};this.params.timeFormat="%d/%m/%Y";this.params.displaylabels=true;this.params.scales={};this.params.xScale=null;this.params.yScale=null;this.params.y2Scale=null;this.params.xKey='date';this.params.yKey='value';this.params.y2Key='value';this.params.activeAxes=false;var chart=function(selection){selection.each(function(data,i){chart.container=d3.select(this);chart.parseData(data);chart.SVG(this);chart.setScales();chart.addAxes();chart.addLines();chart.extra();chart.panAndZoom();chart.addMarkers();});};var method;for(method in this.params){chart[method]=kcharts.makeAPIMethod(chart,this,method);}
chart.margins=function(_){if(!arguments.length){return that.params.margins;}
$.extend(that.params.margins,_);return chart;};chart.parseData=function(data){chart.data=data;if(data[0].date){chart.parseDate=d3.time.format(params.timeFormat).parse;data.forEach(function(d){d.date=chart.parseDate(d.date);});}
chart.color=d3.scale.category10();chart.color.domain(d3.keys(chart.data[0]).filter(function(key){return key!=="date";}));chart.lineData=chart.color.domain().map(function(name){return{name:name,values:data.map(function(d){var obj={value:+d[name]};obj[params.xKey]=d[params.xKey];return obj;})};});};chart.SVG=function(){kcharts.defaultSVG.call(chart);};chart.setScales=function(){chart.x=params.xScale||d3.scale.linear().range([0,chart.w]);chart.y=params.yScale||d3.scale.linear().range([chart.h,0]);chart.defaultDomain=d3.extent(chart.data,function(d,i){return d[params.xKey]||i;});chart.x.domain(chart.defaultDomain);chart.y.domain([d3.min(chart.lineData,function(c){return d3.min(c.values,function(v){return v.value;});}),d3.max(chart.lineData,function(c){return d3.max(c.values,function(v){return v.value;});})]);};chart.addAxes=function(){chart.xAxis=d3.svg.axis().scale(chart.x).tickSize(-chart.h).tickSubdivide(true);chart.yAxis=d3.svg.axis().scale(chart.y).ticks(6).tickSize(-chart.w,0,0).orient("left");kcharts.drawAxes.call(chart);};chart.addLines=function(){chart.line=d3.svg.line().interpolate("basis").x(function(d){return chart.x(d[params.xKey]);}).y(function(d){return chart.y(d[params.yKey]);});chart.lines=chart.svg.selectAll(".lines").data(chart.lineData).enter().append("g");chart.lines.append("path").attr("class","line").attr("clip-path","url(#clip-"+params.id+")").attr("d",function(d){return chart.line(d.values);}).attr("data-legend",function(d){return d.name;}).style("stroke",function(d){return chart.color(d.name);});};chart.addMarkers=function(){chart.legend=chart.svg.append("g").attr("class","legend").attr("transform","translate(20,20)").style("font-size","12px").call(d3.legend);if(!chart.resetButton){chart.resetButton=chart.container.append('button').attr('type','button').attr('class','menu-btn menu-btn-small').text('Reset').style('position','absolute').style('top','0px').on('click',function(d){chart.x.domain(chart.defaultDomain);chart.redraw();});}
chart.extraMarkers();};chart.extraMarkers=function(){};chart.panAndZoom=kcharts.areaZoom;chart.redraw=function(){chart.lines.select('path').attr('d',function(d){return chart.line(d.values);});chart.svg.select(".x.axis").call(chart.xAxis).selectAll("text").style("text-anchor","end").attr("dx","-.8em").attr("dy",".15em").attr("transform",function(d){return"rotate(-65)";});d3.select(".x.brush").call(chart.brush.clear());if(chart.y2){chart.cumline.attr('d',function(d){return chart.cline(chart.cumLineData.values);});}
chart.onRedrawCallback();};chart.update=function(){};return chart;};}(window.kcharts=window.kcharts||{},$,_));(function(kcharts,$,_){'use strict';kcharts.Hist2D=function(){var that=this,params=this.params={};params.id=kutils.makeRandomStringQAD();params.title="";params.yName=null;params.xName=null;params.height=null;params.width=null;params.margins={top:50,right:30,bottom:50,left:70};params.timeFormat="%d/%m/%Y";params.displaylabels=true;params.axes={};params.scales={};params.xKey='';params.yKey='';params.countKey='TotalOrderValue';params.countKeyColor=false;params.activeAxes=false;params.colorBarPosition={};params.colorBar='BYR';params.minVal=false;var chart=function(selection){selection.each(function(data){chart.container=d3.select(this);chart.parseData(data);chart.SVG();chart.setScales();chart.drawAxes();chart.drawData();});},method;for(method in params){chart[method]=kcharts.makeAPIMethod(chart,this,method);}
chart.margins=function(_){if(!arguments.length){return that.params.margins;}
$.extend(that.params.margins,_);return chart;};var x=d3.scale.ordinal(),y=d3.scale.ordinal(),xAxis=chart.xAxis=d3.svg.axis().scale(x).orient("bottom").tickFormat(function(d,i){return d;}),yAxis=chart.yAxis=d3.svg.axis().scale(y).orient("left").tickFormat(function(d,i){return d;});chart.rScale=d3.scale.linear();chart.cScale=d3.scale.linear().interpolate(d3.interpolateHcl);chart.cbscale=d3.scale.linear();chart.SVG=function(){kcharts.defaultSVG.call(chart);};chart.parseData=function(data){chart.data=data.points;chart.xValues=data.xValues;chart.yValues=data.yValues;};chart.setScales=function(){chart.padX=chart.w/(2*chart.xValues.length);chart.padY=chart.h/(2*chart.yValues.length);x.domain(chart.xValues).rangePoints([chart.padX,chart.w-chart.padX]);y.domain(chart.yValues).rangePoints([chart.padY,chart.h-chart.padY]);};chart.drawAxes=function(){xAxis.ticks(chart.xValues.length);yAxis.ticks(chart.yValues.length);kcharts.drawAxes.call(chart);};chart.updateColorBar=function(){var domain,bx=typeof params.colorBarPosition.x!=='undefined'?params.colorBarPosition.x:-params.margins.left,by=typeof params.colorBarPosition.y!=='undefined'?params.colorBarPosition.y:chart.h-10,COLOR_BAR_WIDTH=10,COLOR_BAR_HEIGHT=2;chart.COLOR_BARS=50;domain=[0,chart.COLOR_BARS];if(chart.getDomain().length===3){domain=[0,chart.COLOR_BARS/2,chart.COLOR_BARS];}
chart.cbscale=chart.cbscale.domain(domain).range(chart.getDomain());chart.colorbar=chart.svg.selectAll('.colorbar').data(d3.range(chart.COLOR_BARS)).enter().append('g').attr("transform","translate("+bx+","+by+")").attr('class','colorbar');chart.colorbar.append('rect').attr('width',COLOR_BAR_WIDTH).attr('height',COLOR_BAR_HEIGHT).attr('x',0).attr('y',function(d,i){return-i*COLOR_BAR_HEIGHT;}).attr('fill',function(d){return chart.cScale(chart.cbscale(d));});chart.colorbar.append('text').text(chart.colorbarText).attr("x",COLOR_BAR_WIDTH+5).attr("y",function(d,i){return-i*COLOR_BAR_HEIGHT;}).attr("dy",'.3em').attr('class','cb-text');};chart.colorbarText=function(d,i){var CB_LABEL_INDICES=[0,25,49];if(_.contains(CB_LABEL_INDICES,i)){return parseInt(chart.bounds[0]+(chart.bounds[1]-chart.bounds[0])*(i*1.0/chart.COLOR_BARS),10);}};var addInfoLine=function(type,value){return"</br><strong>"+kutils.titleizeString(type)+":</strong> <span style='color:red'>"+parseInt(value,10)+"</span>"+"<strong>";};var tip=d3.tip().attr('class','d3-tip').offset([-10,0]).html(function(d){var s="<strong>"+kutils.titleizeString(chart.xKey())+":</strong> <span style='color:red'>"+d.x+"</span>"+"<strong></br>"+"<strong>"+kutils.titleizeString(chart.yKey())+":</strong> <span style='color:red'>"+d.y+"</span>"+"<strong>";s+=addInfoLine('Total '+chart.countKey(),d.value);if(chart.countKeyColor()){s+=addInfoLine('Total '+chart.countKeyColor(),d.valueColor);}
return s;});chart.drawData=function(){var bounds=chart.bounds=d3.extent(chart.data.map(function(d){return d.value;}));if(chart.minVal()!==false){bounds[0]=chart.minVal();}
var boundsColor=chart.boundsColor=d3.extent(chart.data.map(function(d){return d.valueColor;})),min=chart.min=Math.sqrt(bounds[0]/3.14),max=chart.max=Math.sqrt(bounds[1]/3.14);chart.rScale.range([0,0.5*d3.min([chart.w/chart.xValues.length,chart.h/chart.yValues.length])]).domain(chart.getRadiusDomain());chart.cScale.domain(chart.getDomain()).range(chart.getRange()).interpolate(d3.interpolateHcl);chart.container.call(tip);var circles=chart.svg.selectAll("circle").data(chart.data);circles.enter().append("circle").attr("class","circle").on('mouseover',tip.show).on('mouseout',tip.hide);circles.exit().remove();circles.transition().duration(1000).attr("cx",function(d){return parseInt(x(d.x),10);}).attr("cy",function(d){return parseInt(y(d.y),10);}).attr("fill",chart.fillCircle).attr("r",chart.circleRadius);chart.updateColorBar();};chart.getRadiusDomain=function(){return[chart.min,chart.max];};chart.getDomain=function(){return[0,0.5,1.0];};chart.getRange=function(){return[kcharts.COLS.blue,kcharts.COLS.yellow,kcharts.COLS.red];};chart.fillCircle=function(d){return chart.c(d.valueInhouse/d.value);};chart.circleRadius=function(d){var x=parseInt(chart.rScale(Math.sqrt(d.value/3.14)),10);if(isNaN(x)){console.log(d);return 1;}
return 1+x;};chart.onXAxisClick=function(d){console.log('x-axis clicked');};chart.onYAxisClick=function(d){console.log('x-axis clicked');};return chart;};}(window.kcharts=window.kcharts||{},$,_));(function(kcharts,$,_){'use strict';kcharts.cross=function(a,b){var c=[],n=a.length,m=b.length,i,j;for(i=-1;++i<n;)for(j=-1;++j<m;)c.push({x:a[i],i:i,y:b[j],j:j});return c;};kcharts.MultiVarChart=function(){this.params={};this.params.columns=['x','y','z'];this.params.colorColumn=false;this.params.width=1024;this.params.padding=10;this.params.size=null;this.params.legendData=[];this.params.legendLabel=function(d){return d;};var chart=function(selection){selection.each(function(data,i){chart.container=this;chart.parseData(data);chart.brushes();chart.SVG(this);});};var method;for(method in this.params){chart[method]=kcharts.makeAPIMethod(chart,this,method);}
chart.params=this.params;chart.parseData=function(data){chart.data=data;chart.size(chart.width()/chart.columns().length-2*chart.padding());var size=chart.size(),padding=chart.padding(),x=chart.x={},y=chart.y={};chart.columns().forEach(function(col){data.forEach(function(d){d[col]=+d[col];});var value=function(d){return d[col];},domain=[d3.min(data,value),d3.max(data,value)],range=[padding/2,size-padding/2];x[col]=d3.scale.linear().domain(domain).range(range);y[col]=d3.scale.linear().domain(domain).range(range.reverse());});};chart.SVG=function(container){var size=chart.size(),cols=chart.columns();var axis=chart.axis=d3.svg.axis().ticks(5).tickSize(chart.size()*cols.length);var svg=chart.svg=d3.select(container).append("svg:svg").attr("width",chart.width()).attr("height",chart.width()+50).append("svg:g");chart.legend=chart.svg.selectAll("g.legend").data(chart.legendData()).enter().append("svg:g").attr("class","legend").attr("transform",function(d,i){return"translate(20,"+(i*20+chart.width()-40)+")";});chart.legend.append("svg:circle").attr("class",String).attr("r",3);chart.legend.append("svg:text").attr("x",12).attr("dy",".31em").text(chart.legendLabel());svg.selectAll("g.x.axis").data(cols).enter().append("svg:g").attr("class","x axis").attr("transform",function(d,i){return"translate("+i*size+",0)";}).each(function(d){d3.select(this).call(axis.scale(chart.x[d]).orient("bottom"));});svg.selectAll("g.y.axis").data(cols).enter().append("svg:g").attr("class","y axis").attr("transform",function(d,i){return"translate(0,"+i*size+")";}).each(function(d){d3.select(this).call(axis.scale(chart.y[d]).orient("right"));});var cell=svg.selectAll("g.cell").data(kcharts.cross(cols,cols)).enter().append("svg:g").attr("class","cell").attr("transform",function(d){return"translate("+d.i*size+","+d.j*size+")";}).each(chart.plot);cell.filter(function(d){return d.i==d.j;}).append("svg:text").attr("x",chart.padding()).attr("y",chart.padding()).attr("dy",".71em").text(function(d){return d.x;});};chart.brushes=function(){var brush=chart.brush=d3.svg.brush().on("brushstart",brushstart).on("brush",brushdo).on("brushend",brushend);function brushstart(p){if(brush.data!==p){chart.cell.call(brush.clear());brush.x(chart.x[p.x]).y(chart.y[p.y]).data=p;}}
function brushdo(p){var e=brush.extent();chart.svg.selectAll(".cell circle").attr("class",function(d){return e[0][0]<=d[p.x]&&d[p.x]<=e[1][0]&&e[0][1]<=d[p.y]&&d[p.y]<=e[1][1]?d[chart.colorColumn()]||'selected':null;});}
function brushend(){if(brush.empty())chart.svg.selectAll(".cell circle").attr("class",function(d){return d[chart.colorColumn()]||'selected';});}};chart.plot=function(p){var size=chart.size(),padding=chart.padding(),cell=chart.cell=d3.select(this);cell.append("svg:rect").attr("class","frame").attr("x",padding/2).attr("y",padding/2).attr("width",size-padding).attr("height",size-padding);cell.selectAll("circle").data(chart.data).enter().append("svg:circle").attr("class",function(d){return d[chart.colorColumn()]||'selected';}).attr("cx",function(d){return chart.x[p.x](d[p.x]);}).attr("cy",function(d){return chart.y[p.y](d[p.y]);}).attr("r",3);cell.call(chart.brush.x(chart.x[p.x]).y(chart.y[p.y]));};return chart;};}(window.kcharts=window.kcharts||{},$,_));(function(){d3.legend=function(g){g.each(function(){var g=d3.select(this),items={},svg=d3.select(g.property("nearestViewportElement")),legendPadding=g.attr("data-style-padding")||5,lb=g.selectAll(".legend-box").data([true]),li=g.selectAll(".legend-items").data([true])
lb.enter().append("rect").classed("legend-box",true)
li.enter().append("g").classed("legend-items",true)
svg.selectAll("[data-legend]").each(function(){var self=d3.select(this)
items[self.attr("data-legend")]={pos:self.attr("data-legend-pos")||this.getBBox().y,color:self.attr("data-legend-color")!=undefined?self.attr("data-legend-color"):self.style("fill")!='none'?self.style("fill"):self.style("stroke")}})
items=d3.entries(items).sort(function(a,b){return a.value.pos-b.value.pos})
li.selectAll("text").data(items,function(d){return d.key}).call(function(d){d.enter().append("text")}).call(function(d){d.exit().remove()}).attr("y",function(d,i){return i+"em"}).attr("x","1em").text(function(d){;return d.key})
li.selectAll("circle").data(items,function(d){return d.key}).call(function(d){d.enter().append("circle")}).call(function(d){d.exit().remove()}).attr("cy",function(d,i){return i-0.25+"em"}).attr("cx",0).attr("r","0.4em").style("fill",function(d){return d.value.color;});var lbbox=li[0][0].getBBox()
lb.attr("x",(lbbox.x-legendPadding)).attr("y",(lbbox.y-legendPadding)).attr("height",(lbbox.height+2*legendPadding)).attr("width",(lbbox.width+2*legendPadding))})
return g}})();(function(navbar,$,_){'use strict';navbar.MENU_BUTTON_BACKGROUND_ON='darkblue';navbar.MENU_BUTTON_BACKGROUND_OFF='darkcyan';var NAV_BAR_HEIGHT=25;navbar.NavBar=function(selector){selector=typeof selector!=='undefined'?selector:'#navbar';this.selector=selector;this.index=0;};navbar.NavBar.prototype={init:function(data){this.data=data;},};navbar.FilterMenu=function(){};navbar.FilterMenu.prototype={init:function(menuData,parent,name,navbar,menu_list){this.parent=typeof parent!=='undefined'?parent:undefined;this.index=typeof parent!=='undefined'?parent.index+1:0;this.navbar=typeof navbar!=='undefined'?navbar:'#filter-menu-bar';this.menu_list=typeof menu_list!=='undefined'?menu_list:'.menu-list';if(parent){this.menu_list=parent.menu_list;}
this.name=typeof name!=='undefined'?name:'Menu '+this.index;this.menu_id=_.str.sprintf('#menu-%d',this.index);this.menuData=menuData;this.isRootMenu=false;if(this.index===0){this.isRootMenu=true;}
this.child=null;if(!this.isRootMenu){this.build();}
this.postInit();return this;},postInit:function(){},getColumnChecks:function(colname,checked_flag){checked_flag=typeof checked_flag!=='undefined'?checked_flag:true;var sel,checklist;sel=d3.selectAll(_.str.sprintf('#menu-%d #column-%s input',this.index,kutils.sanitizeString(colname)))[0].filter(function(d){return d.checked===checked_flag;});checklist=_.map(sel,function(d){return d.__data__.name;});return checklist;},detectChanges:function(){var changes=d3.selectAll(_.str.sprintf('#menu-%d .checkbox input',this.index))[0].filter(function(d){return d.__data__.checked!==d.checked;});this.toggleUpdateButton(changes);this.changes=changes;console.log(this.changes);return changes;},toggleUpdateButton:function(changes){if(changes.length){this.update_button.transition().style('opacity',1).duration(1000);}
else{this.update_button.transition().style('opacity',0).duration(1000);}},closeAllMenus:function(){d3.selectAll('.menu').style('display','none');d3.selectAll('.menu-button').style('background',navbar.MENU_BUTTON_BACKGROUND_OFF);},toggleMenu:function(){if(this.d3menu.style('display')==='none'){d3.selectAll('.menu').style('display','none');this.d3menu.style('display','block');d3.selectAll('.menu-button').style('background',navbar.MENU_BUTTON_BACKGROUND_OFF);this.menu_button.style('background',navbar.MENU_BUTTON_BACKGROUND_ON);}
else{this.d3menu.style('display','none');this.menu_button.style('background',navbar.MENU_BUTTON_BACKGROUND_OFF);}},setMenuName:function(name){this.menu_button.select('.menu_name').html(name);},clickHandler:function(box){var changes,value=box.value,checked=box.checked;console.log('Value: '+value);console.log('Checked: '+checked);this.detectChanges();},updateHandler:function(){console.log('Implementing changes: '+this.changes);},removeColumn:function(col_name){d3.select(this.menu_id+' #column-'+kutils.sanitizeString(col_name)).remove();},setColumnChecks:function(col_name,status){var selector=this.menu_id+' #column-'+kutils.sanitizeString(col_name)+' .checkbox input';d3.selectAll(selector).property('checked',status);this.detectChanges();},selectAll:function(btn){this.setColumnChecks(btn.col_name,true);},selectNone:function(btn){this.setColumnChecks(btn.col_name,false);},resetChecks:function(){d3.selectAll(_.str.sprintf('#menu-%d .checkbox input',this.index)).property('checked',function(d){return d.checked?true:false;});},setColumnRow:function(colName,rowName,status){status=typeof status!=='undefined'?status:true;var selector=this.menu_id+' #column-'+kutils.sanitizeString(colName)+' .checkbox input[data-name="'+rowName+'"]';d3.select(selector).property('checked',status);},closeHandler:function(){this.child.destroy();this.removeCloseButton();},addCloseButton:function(){var menu=this;this.menu_button.append('span').attr('class','glyphicon glyphicon-minus-sign').style('cursor','pointer').on('click',function(e){console.log('clicked menu close');d3.event.stopPropagation();menu.closeHandler();});},flushButtonMenu:function(){this.d3menu.style('left',this.menu_button[0][0].offsetLeft+'px');},removeCloseButton:function(){this.menu_button.select('span.glyphicon').remove();},build:function(){var menu=this;this.d3menubar=d3.select(this.navbar);this.menu_button=this.d3menubar.select('.menu-list').attr('background',navbar.MENU_BUTTON_BACKGROUND_OFF).append('li').attr('class','menu-btn').attr('id',this.menu_id.replace('#','')).style('cursor','pointer').on('click',function(e){menu.toggleMenu();});this.menu_button.append('span').attr('class','menu_name').text(this.name);this.d3menu=this.d3menubar.append('div').attr('class','menu').attr('id',menu.menu_id.replace('#','')).style('float','left').style('top',(NAV_BAR_HEIGHT+menu.menu_button[0][0].offsetTop)+'px').style('left',menu.menu_button[0][0].offsetLeft+'px').style('display','none');this.update_button=this.d3menu.append('button').attr('type','button').attr('class','btn menu-btn update').text('Apply filter').style('display','block').style('opacity',0).style('margin','auto').on('click',function(){menu.updateHandler();});this.columns=this.d3menu.append('div').attr('class','columns').selectAll('columns').data(menu.menuData.cols).enter().append('div').attr('class','selection-column').attr('id',function(d){return'column-'+kutils.sanitizeString(d.name);}).style('margin-right',function(d,i){if(i!==menu.menuData.cols.length-1){return'20px';}
return'';});this.columns.append('h4').text(function(d){return kutils.titleizeString(d.name);});this.columns.append('div').attr('class','btn-group-vertical').selectAll('control-buttons').data(function(d){return[{'name':'all','handler':'selectAll','col_name':d.name},{'name':'none','handler':'selectNone','col_name':d.name}];}).enter().append('button').attr('type','button').attr('class','btn menu-btn menu-btn-small').text(function(d){return d.name;}).on('click',function(d){menu[d.handler](d);});this.columns.selectAll('menu-options').data(function(d){return d.categories.map(function(opt){opt.parent=d.name;return opt;});}).enter().append('div').attr('class','checkbox').append('label').attr('for',function(d,i){return'cb'+i;}).text(function(d){var txt=d.name;if(d.value){txt+='('+d.value+')';}
return txt;}).insert('input').attr('type','checkbox').attr('name','menu-option').attr('class',function(d,i){return'cb'+i;}).attr('data-name',function(d){return d.name;}).property('checked',function(d){return d.checked?true:false;}).on('click',function(){menu.clickHandler(this);});},destroy:function(){this.d3menu.remove();this.menu_button.remove();if(this.child){this.child.destroy();}
this.parent.child=null;}};}(window.navbar=window.navbar||{},$,_));(function(navbar,$,_){'use strict';var FILTER_NAME_STRING='Filter...';navbar.FilterMenuAng=function(){};navbar.FilterMenuAng.prototype=Object.create(navbar.FilterMenu.prototype);_.extend(navbar.FilterMenuAng.prototype,{postInit:function(data){if(this.filter_flag){this.setMenuName(FILTER_NAME_STRING);this.menu_button.style('background',navbar.MENU_BUTTON_BACKGROUND_OFF);}},makeMenuName:function(menuData){var menu=this,s='';this.menuData.cols.map(function(col,i){var colchecks=menu.getColumnChecks(col.name);if(!colchecks.length){return;}
if(i){s+='|';}
s+='<b>'+col.name+'</b>'+':';colchecks.map(function(k,i){if(i){s+=',';}
s+=k;});});return s;},closeHandler:function(){this.recreateFilter();this.data.menuData=this.menuData.cols;this.onDataChange();this.child.destroy();this.child=null;this.setFilterFlag();this.removeCloseButton();this.resetChecks();},hideFilteredCols:function(){var menu=this,filteredCol=function(col){return _.contains(menu.data.filteredCols,col.name);};_.map(_.filter(this.menuData.cols,filteredCol),function(col){menu.removeColumn(col.name);});},setFilterFlag:function(fflag){fflag=typeof fflag!=='undefined'?fflag:true;this.filter_flag=fflag;if(fflag){this.setMenuName(FILTER_NAME_STRING);this.menu_button.style('background',navbar.MENU_BUTTON_BACKGROUND_OFF);}
else{this.setMenuName(this.makeMenuName());}
return this;},makeFilterDimensions:function(){var menu=this;this.menuData.cols.map(function(col){menu.data.dims[col.name]=menu.data.filter.dimension(function(d){return d[col.name];});});},setDataType:function(type,value){this.data[type]=value;this.data.gen[type]+=1;},makeDefaultMenuData:function(){var menu=this,dp=this.data.raw[0],keys=Object.keys(dp);this.menuData={'cols':[]};keys.forEach(function(d){menu.menuData.cols.push({'name':d,'key':d});});},setData:function(data,callback){var menu=this;this.onDataChange=callback;this.data=data;if(this.isRootMenu)
{if(typeof this.menuData==='undefined'){this.makeDefaultMenuData();}
this.data.filter=crossfilter(this.data.raw);this.setDataType('filtered',this.data.raw);this.data.filteredCols=[];this.data.menuChoices=[];this.menuChoices=[];this.data.dims={};this.makeFilterDimensions();this.spawnChildFilter(this.getMenuData(this.data.filter));}
this.filteredCols=this.data.filteredCols.slice();this.hideFilteredCols();return this;},recreateFilter:function(){var menu=this,dim;this.data.menuChoices=this.parent.menuChoices.slice();this.data.filteredCols=this.filteredCols.slice();this.data.filter=crossfilter(this.data.raw);this.makeFilterDimensions();if(this.parent.isRootMenu){this.setDataType('filtered',this.data.raw);}
else{this.data.menuChoices.map(function(col){dim=menu.data.dims[col.name];dim.filterFunction(function(d){return _.contains(col.choices,d);});});this.setDataType('filtered',dim.top(Infinity));}},getMenuData:function(filter,use_local_dims){use_local_dims=typeof use_local_dims!=='undefined'?use_local_dims:true;var menu=this,filterMenuData={};filterMenuData.cols=_.map(this.menuData.cols,function(d){var dim,opts,col={'name':d.name,'key':d.key};if(!use_local_dims){dim=filter.dimension(function(dd){if(!dd[d.name]){return null;}
return dd[d.name];});}
else{dim=menu.data.dims[d.name];}
opts=_.filter(dim.group().top(Infinity),function(d){return d.value>0;});col.categories=_.map(opts,function(dd){return{'name':dd.key,'checked':false,'count':dd.value};});return col;});filterMenuData=this.customMenuFilter(filterMenuData);var fMenuData={'cols':[]};filterMenuData.cols.map(function(d){fMenuData.cols.push({key:d.key,name:d.name,categories:_.map(d.categories,function(dd){return{'name':dd.name,'checked':false,'label':dd.name,'value':dd.count};})});});this.data.menuData=fMenuData.cols;return fMenuData;},customMenuFilter:function(data){return data;},spawnChildFilter:function(filterMenuData){this.child=Object.create(this).init(filterMenuData,this).setFilterFlag().setData(this.data,this.onDataChange);if(!this.isRootMenu){this.setFilterFlag(false);this.removeCloseButton();this.addCloseButton();this.child.flushButtonMenu();this.closeAllMenus();}},getDatasetByIntersection:function(){var menu=this,dim;this.menuData.cols.map(function(col){var colchecks=menu.getColumnChecks(col.name);if(!colchecks.length){return;}
menu.data.filteredCols.push(col.name);menu.data.menuChoices.push({'name':col.name,'choices':colchecks});menu.menuChoices=menu.data.menuChoices.slice();dim=menu.data.filter.dimension(function(d){return d[col.name];});dim.filterFunction(function(d){return _.contains(colchecks,d);});});this.setDataType('filtered',dim.top(Infinity));},setFilteredData:function(newData){this.data.filtered=newData;this.data.menuData=this.filterMenuData.cols;this.onDataChange();},getLastFilter:function(){if(this.child){return this.child.getLastFilter();}
return this;},setColumnRowCurrent:function(colName,rowName,status){var filter=this.getLastFilter();filter.setColumnRow(colName,rowName,true);filter.updateHandler();},updateHandler:function(){if(this.filter_flag){this.getDatasetByIntersection();console.log('Filtered data size: '+this.data.filtered.length);this.spawnChildFilter(this.getMenuData(this.data.filter));this.onDataChange();this.toggleUpdateButton([]);}
else{this.child.destroy();this.recreateFilter();this.getDatasetByIntersection();this.spawnChildFilter(this.getMenuData(this.data.filter));this.onDataChange();}}});}(window.navbar=window.navbar||{},$,_));(function(my3D,$,_){'use strict';my3D.BasicViewer=function(){};my3D.CAMERA_DEFAULT_POS=new THREE.Vector3(0,0,3000);my3D.CAMERA_DEFAULT_ROT=new THREE.Vector3(0,0,0);my3D.CAMERA_TYPE_ORTHO=0;my3D.CAMERA_TYPE_PERSPECTIVE=1;my3D.BasicViewer.prototype={init:function(parent,width,height,focusPoint,camera){this.focusPoint=typeof focusPoint!=='undefined'?focusPoint:new THREE.Vector3(0,0,2000);this.cameraType=typeof camera!=='undefined'?camera:my3D.CAMERA_TYPE_PERSPECTIVE;this.mouse={x:0,y:0,vx:0,vy:0,down:false,groupIntersectPoint:new THREE.Vector3()};this.scene=new THREE.Scene();this.width=width;this.parent=parent;this.height=height;if(this.cameraType===my3D.CAMERA_TYPE_ORTHO){this.camera=new THREE.OrthographicCamera(40,width/height,1,10000);}
else{this.camera=new THREE.PerspectiveCamera(40,width/height,1,10000);this.camera.setLens(30);}
this.camera.position=my3D.CAMERA_DEFAULT_POS.clone();this.projector=new THREE.Projector();this.postInit(parent,width,height);return this;},postInit:function(){},render:function(){this.renderer.render(this.scene,this.camera);if(this.onDebug){this.onDebug();}},onWindowResize:function(){this.camera.aspect=this.width/this.height;this.camera.updateProjectionMatrix();this.renderer.setSize(this.window.innerWidth,this.window.innerHeight);this.render();},windowResize:function(width,height){this.camera.aspect=this.width/this.height;this.camera.updateProjectionMatrix();this.renderer.setSize(width,height);this.render();},resetCamera:function(){this.controls.reset();},animate:function(){requestAnimationFrame(this.animate.bind(this));TWEEN.update();this.controls.update();},transform:function(layout){var duration=1000;TWEEN.removeAll();this.scene.children.forEach(function(object){var newPos=object.element.newPosition;var coords=new TWEEN.Tween(object.position).to({x:newPos.x,y:newPos.y,z:newPos.z},duration).easing(TWEEN.Easing.Sinusoidal.InOut).start();var newRot=object.element.newRotation;if(newRot){var rotate=new TWEEN.Tween(object.rotation).to({x:newRot.x,y:newRot.y,z:newRot.z},duration).easing(TWEEN.Easing.Sinusoidal.InOut).start();}});var update=new TWEEN.Tween(this).to({},duration).onUpdate(this.render.bind(this)).start();},toggleTrackball:function(){this.controls.enabled=this.controls.enabled?false:true;},};my3D.BasicCSS3DViewer=function(){};my3D.BasicCSS3DViewer.prototype=Object.create(my3D.BasicViewer.prototype);_.extend(my3D.BasicCSS3DViewer.prototype,{postInit:function(parent,width,height){console.log('Creating CSS3DViewer...');var vw=this,controls,renderer=this.renderer=new THREE.CSS3DRenderer();renderer.setSize(width,height);renderer.domElement.style.position='absolute';parent.append(renderer.domElement);d3.select(renderer.domElement).classed('v3canvas',true).on('mousedown',function(e){var ray;vw.mouse.down=true;ray=vw.calculateGroupIntersect();vw.mouse.zoomVector=ray.ray.direction.clone().negate();console.log('You clicked a viewer');}).on('mouseup',function(e){vw.selectedGroup=false;vw.render();}).on('mousemove',function(e){if(vw.selectedGroup){var ray,tmpV=vw.mouse.groupIntersectPoint;vw.calculateGroupIntersect();tmpV.subVectors(vw.mouse.groupIntersectPoint,tmpV);if(d3.event.shiftKey){tmpV=vw.mouse.zoomVector.clone().multiplyScalar(tmpV.x);}
vw.selectedGroup.move(tmpV);console.log('Mouse moved by: ['+tmpV.x+','+tmpV.y+']');}});d3.select('body').on('keydown',function(){var KEYCODES={G:71,U:85,H:72,V:86,J:74,K:75,L:76},ORIENTS={72:my3D.HORIZONTAL,86:my3D.VERTICAL};if(vw.mouseOverGroup){var kc=d3.event.keyCode;switch(kc){case KEYCODES.V:case KEYCODES.H:vw.mouseOverGroup.orientation=ORIENTS[kc];vw.mouseOverGroup.updatePositions();vw.transform();vw.render();break;case KEYCODES.G:vw.mouseOverGroup.focusGroup();break;case KEYCODES.U:vw.mouseOverGroup.unfocusGroup();break;case KEYCODES.J:vw.mouseOverGroup.move(new THREE.Vector3(0,0,-500));break;case KEYCODES.K:vw.mouseOverGroup.move(new THREE.Vector3(0,0,500));break;}}});controls=this.controls=new THREE.TrackballControls(this.camera,renderer.domElement);controls.rotateSpeed=0.5;controls.minDistance=100;controls.maxDistance=6000;controls.addEventListener('change',this.render.bind(this));controls.enabled=false;this.dataplanes=[];this.dataplanesByGUID={};this.singleFocus=false;this.focusGroup=new my3D.DataPlane(this,this.focusPoint.clone(),undefined,undefined,false);d3.select(this.focusGroup.frame.background.element).classed('focus-group',true);this.mouseOverGroup=false;},getMouseCoords:function(){var mp=d3.mouse(this.renderer.domElement);this.mouse.x=mp[0];this.mouse.y=mp[1];this.mouse.vx=(mp[0]/this.renderer.domElement.offsetWidth)*2-1;this.mouse.vy=-(mp[1]/this.renderer.domElement.offsetHeight)*2+1;},getMouseRay:function(){var vector,ray;this.getMouseCoords();this.camera.lookAt(this.scene.position);vector=new THREE.Vector3(this.mouse.vx,this.mouse.vy,0.5);this.projector.unprojectVector(vector,this.camera);ray=new THREE.Raycaster(this.camera.position,vector.sub(this.camera.position).normalize());return ray;},calculateGroupIntersect:function(){var plane,ray=this.getMouseRay(),planeZ=0;if(this.selectedGroup){planeZ=this.selectedGroup.position.z;}
plane=new THREE.Plane(new THREE.Vector3(0,0,1),planeZ);this.mouse.groupIntersectPoint=ray.ray.intersectPlane(plane);return ray;},getIntersectObjects:function(){var vector,intersects,vw=this,camera=this.camera,ray=this.getMouseRay();this.mouse.down=true;intersects=ray.intersectObjects(this.scene.children);if(intersects.length>0){if(this.INTERSECTED!==intersects[0].object){if(this.INTERSECTED){this.INTERSECTED.material.color.setHex(this.INTERSECTED.currentHex);}
this.INTERSECTED=intersects[0].object;console.log('Selected object: '+this.INTERSECTED);}}else{if(this.INTERSECTED){}
this.INTERSECTED=null;}},onMouseUp:function(){this.INTERSECTED=null;},onMouseMove:function(){if(this.INTERSECTED){}},addChart:function(chart,group){var pos=group?group.position.clone():THREE.Vector3();console.log('Registering chart: '+chart);var obj=this.objectify2(chart,pos);obj.inFocus=false;chart.guid=kutils.guidGenerator();chart.obj=obj;obj.guid=chart.guid;if(group){obj.inGroup=group.guid;group.addObject(obj);chart.inGroup=group.guid;}
this.transform();return obj;},addDataplane:function(dp){this.dataplanes.push(dp);this.dataplanesByGUID[dp.guid]=dp;},objectify:function(){var viewer=this;return function(d){var object=new THREE.CSS3DObject(this);object.position=d.random.position;viewer.scene.add(object);return object;};},objectify2:function(el,pos){var object=new THREE.CSS3DObject(el);object.position=pos;object.element.newPosition=pos;this.scene.add(object);return object;},selectGroup:function(groupID){this.selectedGroup=this.dataplanesByGUID[groupID];},setMouseOverGroup:function(groupID){this.mouseOverGroup=this.dataplanesByGUID[groupID];},unselectGroup:function(group){},onDebug:function(){var vw=this,db=d3.select('.debugbox'),p=this.camera.position,m=this.mouse.groupIntersectPoint;db.html('');db.append('div').attr('class','elinfo').text(_.string.sprintf('Camera pos.: [%4.1f, %4.1f, %4.1f]',p.x,p.y,p.z));db.append('div').attr('class','elinfo').text(_.string.sprintf('Mouse pos (canvas).: [%4d, %4d]',vw.mouse.x,vw.mouse.y));db.append('div').attr('class','elinfo').text(_.string.sprintf('Mouse vector.: [%4.3f, %4.3f]',vw.mouse.vx,vw.mouse.vy));if(m){db.append('div').attr('class','elinfo').text(_.string.sprintf('Mouse group-intersect: [%4d, %4d, %4d]',m.x,m.y,m.z));}
db.append('h6').text('Objects in Scene:');db.append('ul').selectAll('.objects').data(this.scene.children).enter().append('li').classed('elinfo',true).classed('selected',function(d){if(vw.selectedGroup){return d.element.inGroup===vw.selectedGroup.guid;}
return false;}).text(function(d){var type=d.guid?d.guid.slice(0,4):'frame';return _.string.sprintf('%12s: [%4d, %4d, %4d]',type,d.position.x,d.position.y,d.position.z);});db.append('h6').text('Planes in Scene:');db.selectAll('.objects').data(this.dataplanes).enter().append('div').classed('elinfo',true).text(function(d){return _.string.sprintf('%12s: [%4d, %4d, %4d]',d.guid.slice(0,4),d.position.x,d.position.y,d.position.z);});}});my3D.HORIZONTAL=0;my3D.VERTICAL=1;my3D.DataPlane=function(viewer3d,pos,orientation,padding,controlsFlag){controlsFlag=typeof controlsFlag!=='undefined'?controlsFlag:false;console.log('Creating Dataplane...');this.guid=kutils.guidGenerator();this.viewer=viewer3d;this.viewer.addDataplane(this);this.position=typeof pos!=='undefined'?pos:new THREE.Vector3();this.orientation=typeof orientation!=='undefined'?orientation:my3D.HORIZONTAL;this.padding=typeof padding!=='undefined'?padding:10;this.framePadding=20;this.objects=[];this.objectsByGUID={};this.focusedCharts=[];if(controlsFlag){this.setControls();}
this.makeFrame();};my3D.DataPlane.prototype={setControls:function(){var controls=[{'class':'glyphicon glyphicon-move','callback':this.ctrlMove}];var ctrl=d3.select('body').append('div').attr('class','v3dcontrol');ctrl.append('span').attr('class','glyphicon glyphicon-move');this.viewer.objectify2(ctrl[0][0],this.position.clone());},makeFrame:function(){var domob=d3.select('body').append('div').classed('dp-frame',true);this.frame={};this.frame.background=this.viewer.objectify2(domob[0][0],this.position.clone());},getFrameHeight:function(){if(this.orientation===my3D.HORIZONTAL){if(!this.objects.length){return 0;}
return this.objects[0].element.clientHeight+2*this.framePadding;}
return this.getHeight();},getFrameWidth:function(){if(this.orientation===my3D.VERTICAL){if(!this.objects.length){return 0;}
return this.objects[0].element.clientWidth+2*this.framePadding;}
return this.getWidth();},addObject:function(obj){this.objects.push(obj);this.objectsByGUID[obj.element.guid]=obj;obj.inGroup=this.guid;this.updatePositions();},removeObject:function(obj){this.objects=this.objects.filter(function(o){return o.guid!==obj.guid;});delete this.objectsByGUID[obj.guid];this.updatePositions();},focusChart:function(chart){var dp=this,obj=this.objectsByGUID[chart.guid],idx=this.focusedCharts.indexOf(chart.guid);if(idx!==-1){obj.inFocus=false;obj.inGroup=this.guid;this.focusedCharts.splice(idx,1);this.viewer.focusGroup.removeObject(obj);}
else{if(this.viewer.singleFocus){this.focusedCharts.forEach(function(c){c.inFocus=false;c.inGroup=dp.guid;});}
obj.inFocus=true;this.viewer.focusGroup.addObject(obj);this.focusedCharts.push(chart.guid);}
this.updatePositions();},updatePositions:function(){this.repositionCharts();this.repositionFrame();this.viewer.transform();this.viewer.render();},focusGroup:function(){var dp=this;this.objects.forEach(function(obj){obj.inFocus=true;dp.viewer.focusGroup.addObject(obj);dp.focusedCharts.push(obj.element.guid);});this.updatePositions();},unfocusGroup:function(){var dp=this;this.objects.forEach(function(obj){obj.inFocus=false;dp.viewer.focusGroup.removeObject(obj);dp.focusedCharts.push(obj.element.guid);});this.updatePositions();},resetCharts:function(){var dp=this;this.objects.forEach(function(o){o.inGroup=dp.guid;o.inFocus=false;});},getWidth:function(){var dp=this;this.width=-this.padding;this.objects.forEach(function(obj){if(obj.inGroup===dp.guid){dp.width+=obj.element.clientWidth+dp.padding;}});return this.width;},getHeight:function(){var dp=this;this.height=-this.padding;this.objects.forEach(function(obj){if(obj.inGroup==dp.guid){dp.height+=obj.element.clientHeight+dp.padding;}});return this.height;},repositionFrame:function(){d3.select(this.frame.background.element).transition().duration(1000).style('height',this.getFrameHeight()+'px').style('width',this.getFrameWidth()+'px');this.frame.background.position=this.position.clone();this.frame.background.position.z-=1;this.frame.background.element.newPosition=this.position.clone();this.frame.background.element.newPosition.z-=1;},repositionCharts:function(){var dp=this;if(this.orientation==my3D.HORIZONTAL){var startX=-this.getWidth()/2;this.objects.forEach(function(obj){if(obj.inGroup===dp.guid){obj.element.newPosition=new THREE.Vector3(dp.position.x+startX+obj.element.clientWidth/2,dp.position.y,dp.position.z);startX+=obj.element.clientWidth;}});}
else{var startY=-this.getHeight()/2;this.objects.forEach(function(obj){if(obj.inGroup===dp.guid){obj.element.newPosition=new THREE.Vector3(dp.position.x,dp.position.y+startY+obj.element.clientHeight/2,dp.position.z);startY+=obj.element.clientHeight;}});}},move:function(dp){this.position.add(dp);this.objects.forEach(function(obj){if(!obj.inFocus){obj.position.add(dp);obj.element.newPosition=obj.position.clone();}});this.repositionFrame();this.viewer.render();},};}(window.my3D=window.my3D||{},$,_));